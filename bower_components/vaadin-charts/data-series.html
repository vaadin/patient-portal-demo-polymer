<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="configuration-reader.html"><script>DataSeries=Polymer({is:'data-series',behaviors:[VaadinCharts.ConfigurationReaderBehavior],properties:{drilldown:{type:Boolean,value:!1},data:{type:Array},_seriesConf:{type:Object,value:function(){return{}}},_seriesIndex:Number,_observer:Object},observers:['_dataChanged(data.splices)'],_reloadConfiguration:function(){this._seriesConf={},this._initConfiguration(),!this._seriesConf.hasOwnProperty('data')&&this.data&&(this._seriesConf.data=this.data),this._seriesIndex=this.drilldown?this._parentChart()._addDrilldownSeries(this._seriesConf):this._parentChart()._addSeries(this._seriesConf)},_dataChanged:function(){this._seriesIndex!=void 0&&this._parentChart().isInitialized()?this._updateChartData(this.data):this._seriesConf.data=this.data},_updateChartData:function(b){this.drilldown?this._parentChart().chart.drilldown.series[this._seriesIndex].setData(b):this._parentChart().chart.series[this._seriesIndex].setData(b)},_ignoredNodes:['#text','#comment','data'],_evalJavascript:function(b){return 0===b.indexOf('function')||0===b.indexOf('Date.UTC')||0===b.indexOf('[')},_parentChart:function(){for(var b=Polymer.dom(this.root).parentNode;b._addSeries===void 0;)b=b.parentNode;return b},_loadData:function(){for(var b=Polymer.dom(this),c=0;c<b.childNodes.length;c++){var d=b.childNodes[c],f=d.nodeName.toLowerCase(),g=this._toCamelCase(f);if('data'===g){var h;if(this._hasPointNodes(d)){h=[];for(var i=0;i<d.childNodes.length;i++)this._isPointNode(d.childNodes[i])&&h.push(this._parsePoint(d.childNodes[i]))}else{var j=d.textContent.replace(/(\n)/gm,' ');h='['+j+']'}this._setProperty(g,h)}}},_parsePoint:function(b){for(var f,c={},d=0;d<b.childNodes.length;d++)if(f=b.childNodes[d],this._hasOnlyTextContent(f)){var g=this._toCamelCase(f.nodeName.toLowerCase());if('date'!==g)void 0===c[g]?c[g]=this._parseAttribute(f.textContent):console.log(g+' value is already defined for this point, \''+f.textContent+'\' couldn\'t be set');else if(void 0===c.x){var h=this._parseDate(f.textContent);void 0===h?console.log('Unable to parse date: '+f.textContent):c.x=h}else console.log('x value is already defined for this point, \''+f.textContent+'\' couldn\'t be set')}return this._loadConfiguration(c,b),c},_parseDate:function(b){if(this._isValidDate(b))return Date.parse(b)},_isValidDate:function(b){try{var c=new Date(b);return 0===c.toISOString().indexOf(b)&&'[object Date]'===Object.prototype.toString.call(c)&&!isNaN(c.getTime())}catch(d){}return!1},_hasPointNodes:function(b){var c=Array.prototype.slice.call(b.children,0);return 0<c.length&&0<c.filter(this._isPointNode).length},_isPointNode:function(b){return 1===b.nodeType&&'point'===b.nodeName.toLowerCase()},_setProperty:function(b,c){var d=this._parseAttribute(c);void 0!==d&&(void 0===this._seriesConf[b]?this._seriesConf[b]=d:'data'===b&&Array.prototype.push.apply(this._seriesConf[b],d))},created:function(){this._seriesConf=this.properties._seriesConf.value()},_initialize:function(){this._initConfiguration(),this._seriesIndex=this.drilldown?this._parentChart()._addDrilldownSeries(this._seriesConf):this._parentChart()._addSeries(this._seriesConf)},_initConfiguration:function(){var b=Polymer.dom(this);this._cleanNode(b),this._loadFromNode(this._seriesConf,b.node),this._loadConfiguration(this._seriesConf,b),this._loadData(),this._addDataPointsObserver()},_addDataPointsObserver:function(){if(MutationObserver&&!this._observer){var b=Polymer.dom(this).querySelectorAll('data');if(b&&0<b.length){this._observer=new MutationObserver(this._reloadData.bind(this));for(var c=0;c<b.length;c++)this._observer.observe(b[c],{attributes:!1,childList:!0,characterData:!0,characterDataOldValue:!1,subtree:!0})}}},_reloadData:function(){this._seriesConf.data=[],this._loadData(),this._updateChartData(this._seriesConf.data)}});</script></head><body></body></html>