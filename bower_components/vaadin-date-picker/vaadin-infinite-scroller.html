<html><head><link rel="import" href="../polymer/polymer.html"></head><body><dom-module id="vaadin-infinite-scroller"><template><style>:host{display:block;overflow:hidden;height:500px;}#scroller{position:relative;height:100%;overflow:auto;outline:none;margin-right:-40px;-webkit-overflow-scrolling:touch;-ms-overflow-style:none;overflow-x:hidden;}#scroller.notouchscroll{-webkit-overflow-scrolling:auto;}#scroller::-webkit-scrollbar{display:none;}.buffer{position:absolute;width:100%;box-sizing:border-box;padding-right:40px;@apply (--vaadin-infinite-scroller-buffer);}:host(:not([init-animation-done])) .buffer > *{animation:fadein 0.2s;}@keyframes fadein{from{opacity:0;}to{opacity:1;}}</style><div id="scroller"><div class="buffer"></div><div class="buffer"></div><div id="fullHeight"></div></div></template></dom-module><script>Polymer({is:'vaadin-infinite-scroller',behaviors:[Polymer.Templatizer],properties:{itemHeight:{type:Number,value:50},bufferSize:{type:Number,value:20},_initialScroll:{value:5e5},_initialIndex:{value:0},_buffers:Array,_preventScrollEvent:Boolean,_bufferHeight:Number,_mayHaveMomentum:Boolean,_initialized:Boolean,active:Boolean},observers:['_activated(active)'],_activated:function(b){b&&!this._initialized&&(this._createPool(),this._initialized=!0)},listeners:{animationend:'_animationEnd'},_animationEnd:function(){this.toggleAttribute('init-animation-done',!0)},_finishInit:function(){this._initDone||(this._buffers.forEach(function(b){[].forEach.call(b.children,function(c){this._ensureStampedInstance(c)}.bind(this))},this),!this._buffers[0].translateY&&this._reset(),this._initDone=!0)},ready:function(){this._bufferHeight=this.itemHeight*this.bufferSize,this._buffers=Polymer.dom(this.root).querySelectorAll('.buffer'),this.$.fullHeight.style.height=2*this._initialScroll+'px';var b=Polymer.dom(this).querySelector('template');this.templatize(b);var c=-1<navigator.userAgent.toLowerCase().indexOf('firefox');c&&(this.$.scroller.tabIndex=-1)},_translateBuffer:function(b){var c=b?1:0;this._buffers[c].translateY=this._buffers[c?0:1].translateY+this._bufferHeight*(c?-1:1),this.transform('translate3d(0, '+this._buffers[c].translateY+'px, 0)',this._buffers[c]),this._buffers[c].updated=!1,this._buffers.reverse()},_scroll:function(){var b=this.$.scroller.scrollTop;(b<this._bufferHeight||b>2*this._initialScroll-this._bufferHeight)&&(this._initialIndex=~~this.position,this._reset());var c=this.$$('.buffer').offsetTop,d=b>this._buffers[1].translateY+this.itemHeight+c,e=b<this._buffers[0].translateY+this.itemHeight+c;(d||e)&&(this._translateBuffer(e),this._updateClones()),this._preventScrollEvent||(this.fire('scroll'),this._mayHaveMomentum=!0),this._preventScrollEvent=!1,this.debounce('scrollFinish',function(){var f=this.$.scroller.getBoundingClientRect();this._isVisible(this._buffers[0],f)||this._isVisible(this._buffers[1],f)||(this.position=this.position)},200)},set position(a){this._preventScrollEvent=!0,a>this._firstIndex&&a<this._firstIndex+2*this.bufferSize?this.$.scroller.scrollTop=this.itemHeight*(a-this._firstIndex)+this._buffers[0].translateY:(this._initialIndex=~~a,this._reset(),this.unlisten(this.$.scroller,'scroll','_scroll'),this.$.scroller.scrollTop+=a%1*this.itemHeight,this.listen(this.$.scroller,'scroll','_scroll')),this._mayHaveMomentum&&(this.$.scroller.classList.add('notouchscroll'),this._mayHaveMomentum=!1,this.async(function(){this.$.scroller.classList.remove('notouchscroll')},10))},get position(){return(this.$.scroller.scrollTop-this._buffers[0].translateY)/this.itemHeight+this._firstIndex},_reset:function(){this.unlisten(this.$.scroller,'scroll','_scroll'),this.$.scroller.scrollTop=this._initialScroll,this._buffers[0].translateY=this._initialScroll-this._bufferHeight,this._buffers[1].translateY=this._initialScroll,this._buffers.forEach(function(b){Polymer.Base.transform('translate3d(0, '+b.translateY+'px, 0)',b)}),this._buffers[0].updated=this._buffers[1].updated=!1,this._updateClones(!0),this.debounce('updateAllClones',function(){this._buffers[0].updated=this._buffers[1].updated=!1,this._updateClones()},200),this.listen(this.$.scroller,'scroll','_scroll')},_createPool:function(){var b=this.getBoundingClientRect();this._buffers.forEach(function(c){for(var e,d=0;d<this.bufferSize;d++)e=document.createElement('div'),e.style.height=this.itemHeight+'px',e.instance={},Polymer.dom(c).appendChild(e),this.async(function(f,g){this._isVisible(f,g)&&this._ensureStampedInstance(f)}.bind(this,e,b),1),Polymer.RenderStatus.afterNextRender(e,this._finishInit.bind(this))},this)},_ensureStampedInstance:function(b){if(!b.firstElementChild){var c=b.instance;b.instance=this.stamp({}),Polymer.dom(b).appendChild(b.instance.root),Object.keys(c).forEach(function(d){b.instance[d]=c[d]})}},_updateClones:function(b){this._firstIndex=~~((this._buffers[0].translateY-this._initialScroll)/this.itemHeight)+this._initialIndex;var c=b?this.$.scroller.getBoundingClientRect():void 0;this._buffers.forEach(function(d,e){if(!d.updated){var f=this._firstIndex+this.bufferSize*e;[].forEach.call(d.children,function(g,h){(!b||this._isVisible(g,c))&&(g.instance.index=f+h)}.bind(this)),d.updated=!0}},this)},_isVisible:function(b,c){var d=b.getBoundingClientRect();return d.bottom>c.top&&d.top<c.bottom},_forwardParentProp:function(b,c){'index'!==b&&this._buffers.forEach(function(d){[].forEach.call(d.children,function(e){e.instance[b]=c})})},_forwardParentPath:function(b,c){'index'!==b&&this._buffers.forEach(function(d){[].forEach.call(d.children,function(e){e.instance.notifyPath(b,c,!0)})})}});</script></body></html>