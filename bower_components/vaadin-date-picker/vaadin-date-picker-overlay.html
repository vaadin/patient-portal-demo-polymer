<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../paper-styles/shadow.html"><link rel="import" href="../paper-styles/typography.html"><link rel="import" href="../iron-icon/iron-icon.html"><link rel="import" href="../iron-input/iron-input.html"><link rel="import" href="../paper-input/paper-input-container.html"><link rel="import" href="../iron-media-query/iron-media-query.html"><link rel="import" href="../paper-button/paper-button.html"><link rel="import" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"><link rel="import" href="../iron-a11y-announcer/iron-a11y-announcer.html"><link rel="import" href="vaadin-month-calendar.html"><link rel="import" href="vaadin-infinite-scroller.html"><link rel="import" href="vaadin-date-picker-helper.html"><link rel="import" href="vaadin-date-picker-icons.html"></head><body><dom-module id="vaadin-date-picker-overlay"><template><style>:host{display:flex;flex-direction:column;height:100%;width:100%;background:var(--primary-background-color);font:inherit;outline:none;@apply (--paper-font-common-base);@apply (--shadow-elevation-2dp);@apply (--vaadin-date-picker-overlay);}#toolbar{display:flex;justify-content:space-between;padding:14px;background:var(--primary-background-color);z-index:2;@apply (--paper-font-button);@apply (--shadow-elevation-2dp);flex-shrink:0;transform:translateZ(0);color:var(--primary-color);@apply (--vaadin-date-picker-toolbar);}#toolbar:not([desktop]){cursor:pointer;}#toolbar iron-icon{fill:var(--primary-color);padding:0;transition:transform 200ms;will-change:transform;--iron-icon-width:20px;--iron-icon-height:20px;@apply (--vaadin-date-picker-toolbar-icon);}#toolbar iron-icon[rotate]{transform:rotate(180deg);}#toolbar iron-icon[hidden]{display:none;}#scrollers{display:flex;flex-direction:row;height:100%;width:100%;position:relative;overflow:hidden;}#scrollers #fade{pointer-events:none;display:block;background:linear-gradient(90deg, var(--primary-background-color), rgba(255, 255, 255, 0));width:50px;position:absolute;height:100%;z-index:1;transform:translateX(-100%);@apply (--vaadin-date-picker-scrollers-fade);}#scrollers[desktop] #fade{display:none;}#scroller,
      #yearScroller{height:100%;}#scroller{padding:0 8px;position:absolute;top:0;left:0;right:0;bottom:0;}#scrollers[desktop] #scroller{right:50px;transform:none !important;}#yearScroller{text-align:center;width:50px;background:var(--dark-theme-background-color);color:var(--dark-theme-secondary-color);cursor:pointer;position:absolute;right:0;transform:translateX(100%);-webkit-tap-highlight-color:transparent;@apply (--paper-font-menu);@apply (--vaadin-date-picker-yearscroller);}#yearScroller div{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}#scrollers[desktop] #yearScroller{position:absolute;transform:none !important;}#yearScroller{--vaadin-infinite-scroller-buffer:{top:50%;margin-top:-12px;width:90px;};}#yearScroller::before{content:'';display:block;background:transparent;width:0;height:0;position:absolute;left:0;top:50%;margin-top:-6px;border-width:6px;border-style:solid;border-color:transparent;border-left-color:var(--primary-background-color);@apply (--vaadin-date-picker-yearscroller-indicator);}:host(.animate) vaadin-infinite-scroller{transition:all 200ms;}:host(:not([fullscreen])) #header{display:none;}#toolbar[desktop]{display:none;}#header{background:var(--primary-color);padding:0 14px 14px;display:flex;flex-shrink:0;height:64px;box-sizing:border-box;@apply (--paper-font-subhead);@apply (--shadow-elevation-2dp);@apply (--vaadin-date-picker-header);}#header label,
      #header input{color:var(--dark-theme-text-color);}#header iron-icon{color:var(--dark-theme-text-color);cursor:pointer;}#toggle{align-self:flex-end;}#header paper-input-container{flex:1;margin-right:24px;padding-bottom:0;--paper-input-container-underline:{display:none;};--paper-input-container-underline-focus:{display:block;background:var(--dark-theme-text-color);-webkit-transform:none;transform:none;};}#clear{display:none;}#clear[showclear]{display:flex;}#footer{display:flex;justify-content:space-between;padding:4px;@apply (--paper-font-body2);background:var(--primary-background-color);z-index:2;box-shadow:0 -1px 4px 0 rgba(0, 0, 0, 0.5);color:var(--primary-color);flex-shrink:0;@apply (--vaadin-date-picker-footer);}paper-button.keyboard-focus{color:var(--primary-background-color);background:var(--primary-color);outline:none;}#announcer{display:inline-block;position:fixed;clip:rect(0, 0, 0, 0);clip-path:inset(100%);}</style><div id="announcer" role="alert" aria-live="polite">[[i18n.calendar]]</div><div id="header" on-touchend="_preventDefault" aria-hidden="true"><paper-input-container><label>[[label]]</label><input id="input" readonly="" is="iron-input" autocomplete="off" bind-value="[[_formatDisplayed(selectedDate, i18n.formatDate)]]"><iron-icon id="clear" suffix="" on-tap="_clear" icon="vaadin-date-picker:clear" showclear$="[[_showClear(selectedDate)]]"></iron-icon></paper-input-container><iron-icon id="toggle" icon="vaadin-date-picker:event" on-tap="_cancel"></iron-icon></div><div id="toolbar" desktop$="[[_desktopMode]]" on-tap="_toggleYearScroller" aria-hidden="true">[[_yearAfterXMonths(_visibleMonthIndex)]]<iron-icon rotate$="[[_isYearScrollerVisible(_translateX)]]" icon="vaadin-date-picker:chevron-right"></iron-icon></div><div id="scrollers" desktop$="[[_desktopMode]]" on-track="_track"><div id="fade"></div><vaadin-infinite-scroller id="scroller" on-scroll="_onMonthScroll" on-touchstart="_onMonthScrollTouchStart" item-height="250" buffer-size="6" active="[[initialPosition]]"><template><vaadin-month-calendar i18n="[[i18n]]" month="[[_dateAfterXMonths(index)]]" selected-date="{{selectedDate}}" focused-date="[[focusedDate]]" ignore-taps="[[_ignoreTaps]]" show-week-numbers="[[showWeekNumbers]]" min-date="[[minDate]]" max-date="[[maxDate]]" focused$="[[_focused]]"></vaadin-month-calendar></template></vaadin-infinite-scroller><vaadin-infinite-scroller id="yearScroller" on-tap="_onYearTap" on-scroll="_onYearScroll" on-touchstart="_onYearScrollTouchStart" item-height="80" buffer-size="25" active="[[initialPosition]]"><template><div role="button">[[_yearAfterXYears(index)]]</div><div style="font-size: 18px; line-height: 56px; opacity: 0.3" aria-hidden="true">â€¢</div></template></vaadin-infinite-scroller></div><div id="footer" on-touchend="_preventDefault" role="toolbar"><paper-button id="todayButton" disabled="[[!_isTodayAllowed(minDate, maxDate)]]" on-tap="_onTodayTap">[[i18n.today]]</paper-button><paper-button id="cancelButton" on-tap="_cancel">[[i18n.cancel]]</paper-button></div><iron-media-query query="(min-width: 375px)" query-matches="{{_desktopMode}}"></iron-media-query></template><script>Polymer({is:'vaadin-date-picker-overlay',listeners:{keydown:'_onKeydown',scroll:'_stopPropagation',tap:'_stopPropagation',focus:'_onOverlayFocus',blur:'_onOverlayBlur'},hostAttributes:{tabIndex:'0'},properties:{selectedDate:{type:Date,notify:!0},focusedDate:{type:Date,notify:!0,observer:'_focusedDateChanged'},_focusedMonthDate:Number,initialPosition:{type:Date,observer:'_initialPositionChanged'},_originDate:{value:new Date},_visibleMonthIndex:Number,_desktopMode:Boolean,_translateX:{observer:'_translateXChanged'},_yearScrollerWidth:{value:50},i18n:{type:Object},showWeekNumbers:{type:Boolean},_ignoreTaps:Boolean,_notTapping:Boolean,minDate:Date,maxDate:Date,_focused:Boolean},attached:function(){this._translateX=this._yearScrollerWidth,this.toggleClass('animate',!0),this.setScrollDirection('y',this.$.scrollers),Polymer.IronA11yAnnouncer.requestAvailability()},announceFocusedDate:function(){var f=this._currentlyFocusedDate(),g=[];return vaadin.elements.datepicker.DatePickerHelper._dateEquals(f,new Date)&&g.push(this.i18n.today),g=g.concat([this.i18n.weekdays[f.getDay()],f.getDate(),this.i18n.monthNames[f.getMonth()],f.getFullYear()]),this.showWeekNumbers&&1===this.i18n.firstDayOfWeek&&(g.push(this.i18n.week),g.push(vaadin.elements.datepicker.DatePickerHelper._getISOWeekNumber(f))),void this.fire('iron-announce',{text:g.join(' ')})},focusCancel:function(){this.$.cancelButton.focus()},scrollToDate:function(f,g){this._scrollToPosition(this._differenceInMonths(f,this._originDate),g)},_focusedDateChanged:function(f){this.revealDate(f)},revealDate:function(f){if(f){var g=this._differenceInMonths(f,this._originDate),h=this.$.scroller.position>g,j=this.$.scroller.clientHeight/this.$.scroller.itemHeight,l=this.$.scroller.position+j-1<g;h?this._scrollToPosition(g,!0):l&&this._scrollToPosition(g-j+1,!0)}},_onOverlayFocus:function(){this._focused=!0},_onOverlayBlur:function(){this._focused=!1},_initialPositionChanged:function(f){this.scrollToDate(f)},_repositionYearScroller:function(){this._visibleMonthIndex=Math.floor(this.$.scroller.position),this.$.yearScroller.position=(this.$.scroller.position+this._originDate.getMonth())/12},_repositionMonthScroller:function(){this.$.scroller.position=12*this.$.yearScroller.position-this._originDate.getMonth(),this._visibleMonthIndex=Math.floor(this.$.scroller.position)},_onMonthScroll:function(){this._repositionYearScroller(),this._doIgnoreTaps()},_onYearScroll:function(){this._repositionMonthScroller(),this._doIgnoreTaps()},_onYearScrollTouchStart:function(){this._notTapping=!1,this.async(function(){this._notTapping=!0},300),this._repositionMonthScroller()},_onMonthScrollTouchStart:function(){this._repositionYearScroller()},_doIgnoreTaps:function(){this._ignoreTaps=!0,this.debounce('restore-taps',function(){this._ignoreTaps=!1},300)},_formatDisplayed:function(f,g){if(f)return g(f)},_onTodayTap:function(){var f=new Date;this.$.scroller.position===this._differenceInMonths(f,this._originDate)?(this.selectedDate=f,this._close()):this._scrollToCurrentMonth()},_scrollToCurrentMonth:function(){this.focusedDate&&(this.focusedDate=new Date),this.scrollToDate(new Date,!0)},_showClear:function(f){return null!==f},_onYearTap:function(f){if(!this._ignoreTaps&&!this._notTapping){var g=f.detail.y-(this.$.yearScroller.getBoundingClientRect().top+this.$.yearScroller.clientHeight/2),h=g/this.$.yearScroller.itemHeight;this._scrollToPosition(this.$.scroller.position+12*h,!0)}},_scrollToPosition:function(f,g){if(void 0!==this._targetPosition)return void(this._targetPosition=f);if(!g)return this.$.scroller.position=f,this._targetPosition=void 0,void this._repositionYearScroller();this._targetPosition=f;var h=function(p,q,r,s){return(p/=s/2,1>p)?r/2*p*p+q:(p--,-r/2*(p*(p-2)-1)+q)},j=g?300:0,l=0,m=this.$.scroller.position,n=function(o){l=l||o;var p=o-l;if(p<j){var q=h(p,m,this._targetPosition-m,j);this.$.scroller.position=q,window.requestAnimationFrame(n)}else this.fire('scroll-animation-finished',{position:this._targetPosition,oldPosition:m}),this.$.scroller.position=this._targetPosition,this._targetPosition=void 0;this.async(this._repositionYearScroller,1)}.bind(this);window.requestAnimationFrame(n)},_limit:function(f,g){return Math.min(g.max,Math.max(g.min,f))},_handleTrack:function(f){if(!(10>Math.abs(f.detail.dx)||10<Math.abs(f.detail.ddy))){Math.abs(f.detail.ddx)>this._yearScrollerWidth/3&&this.toggleClass('animate',!0);var g=this._translateX+f.detail.ddx;this._translateX=this._limit(g,{min:0,max:this._yearScrollerWidth})}},_track:function(f){if(!this._desktopMode)switch(f.detail.state){case'start':this.toggleClass('animate',!1);break;case'track':this._handleTrack(f);break;case'end':this.toggleClass('animate',!0),this._translateX>=this._yearScrollerWidth/2?this._closeYearScroller():this._openYearScroller();}},_toggleYearScroller:function(){this._isYearScrollerVisible()?this._closeYearScroller():this._openYearScroller()},_openYearScroller:function(){this._translateX=0},_closeYearScroller:function(){this._translateX=this._yearScrollerWidth},_isYearScrollerVisible:function(){return this._translateX<this._yearScrollerWidth/2},_translateXChanged:function(f){this._desktopMode||(this.transform('translateX('+(f-this._yearScrollerWidth)+'px)',this.$.scroller),this.transform('translateX('+f+'px)',this.$.yearScroller),this.transform('translateX('+-f+'px)',this.$.fade))},_yearAfterXYears:function(f){var g=new Date(this._originDate);return g.setFullYear(parseInt(f)+this._originDate.getFullYear()),g.getFullYear()},_yearAfterXMonths:function(f){return this._dateAfterXMonths(f).getFullYear()},_dateAfterXMonths:function(f){var g=new Date(this._originDate);return g.setDate(1),g.setMonth(parseInt(f)+this._originDate.getMonth()),g},_differenceInMonths:function(f,g){var h=12*(f.getFullYear()-g.getFullYear());return h-g.getMonth()+f.getMonth()},_differenceInYears:function(f,g){return this._differenceInMonths(f,g)/12},_clear:function(){this.selectedDate='',this._close()},_close:function(){this.fire('close')},_cancel:function(){this.focusedDate=this.selectedDate,this._close()},_preventDefault:function(f){f.preventDefault()},_eventKey:function(f){for(var j,g=['down','up','right','left','enter','space','home','end','pageup','pagedown','tab'],h=0;h<g.length;h++)if(j=g[h],Polymer.IronA11yKeysBehavior.keyboardEventMatchesKeys(f,j))return j},_onKeydown:function(f){var g=this._currentlyFocusedDate(),h=this._eventKey(f);if('tab'===h)f.stopPropagation(),this.hasAttribute('fullscreen')?f.preventDefault():this.$.cancelButton.focused&&!f.shiftKey||this._focused&&f.shiftKey?(f.preventDefault(),this.fire('focus-input')):this.async(function(){this._focused&&this.revealDate(this.focusedDate)},1);else if(h)switch(f.preventDefault(),f.stopPropagation(),h){case'down':this._moveFocusByDays(7),this.focus();break;case'up':this._moveFocusByDays(-7),this.focus();break;case'right':this._buttonFocused()||this._moveFocusByDays(1);break;case'left':this._buttonFocused()||this._moveFocusByDays(-1);break;case'enter':this._buttonFocused()||this._close();break;case'space':var j=this.focusedDate;vaadin.elements.datepicker.DatePickerHelper._dateEquals(j,this.selectedDate)?(this.selectedDate='',this.focusedDate=j):this.selectedDate=j;break;case'home':this._moveFocusInsideMonth(g,'minDate');break;case'end':this._moveFocusInsideMonth(g,'maxDate');break;case'pagedown':this._moveFocusByMonths(f.shiftKey?12:1);break;case'pageup':this._moveFocusByMonths(f.shiftKey?-12:-1);}},_buttonFocused:function(){return this.$.todayButton.focused||this.$.cancelButton.focused},_currentlyFocusedDate:function(){return this.focusedDate||this.selectedDate||this.initialPosition||new Date},_moveFocusByDays:function(f){var g=this._currentlyFocusedDate(),h=new Date(0,0);h.setFullYear(g.getFullYear()),h.setMonth(g.getMonth()),h.setDate(g.getDate()+f),this._dateAllowed(h,this.minDate,this.maxDate)?(this.focusedDate=h,this._focusedMonthDate=this.focusedDate.getDate()):this._dateAllowed(g,this.minDate,this.maxDate)?0<f?(this.focusedDate=this.maxDate,this._focusedMonthDate=this.maxDate.getDate()):(this.focusedDate=this.minDate,this._focusedMonthDate=this.minDate.getDate()):(this.focusedDate=vaadin.elements.datepicker.DatePickerHelper._getClosestDate(g,[this.minDate,this.maxDate]),this._focusedMonthDate=this.focusedDate.getDate())},_moveFocusByMonths:function(f){var g=this._currentlyFocusedDate(),h=new Date(0,0);h.setFullYear(g.getFullYear()),h.setMonth(g.getMonth()+f);var j=h.getMonth();h.setDate(this._focusedMonthDate||(this._focusedMonthDate=g.getDate())),h.getMonth()!==j&&h.setDate(0),this._dateAllowed(h,this.minDate,this.maxDate)?this.focusedDate=h:this._dateAllowed(g,this.minDate,this.maxDate)?0<f?(this.focusedDate=this.maxDate,this._focusedMonthDate=this.maxDate.getDate()):(this.focusedDate=this.minDate,this._focusedMonthDate=this.minDate.getDate()):(this.focusedDate=vaadin.elements.datepicker.DatePickerHelper._getClosestDate(g,[this.minDate,this.maxDate]),this._focusedMonthDate=this.focusedDate.getDate())},_moveFocusInsideMonth:function(f,g){var h=new Date(0,0);h.setFullYear(f.getFullYear()),'minDate'===g?(h.setMonth(f.getMonth()),h.setDate(1)):(h.setMonth(f.getMonth()+1),h.setDate(0)),this._dateAllowed(h,this.minDate,this.maxDate)?(this.focusedDate=h,this._focusedMonthDate=this.focusedDate.getDate()):this._dateAllowed(f,this.minDate,this.maxDate)?(this.focusedDate=this[g],this._focusedMonthDate=this[g].getDate()):(this.focusedDate=vaadin.elements.datepicker.DatePickerHelper._getClosestDate(f,[this.minDate,this.maxDate]),this._focusedMonthDate=this.focusedDate.getDate())},_dateAllowed:function(f,g,h){return(!g||f>=g)&&(!h||f<=h)},_isTodayAllowed:function(f,g){var h=new Date,j=new Date(0,0);return j.setFullYear(h.getFullYear()),j.setMonth(h.getMonth()),j.setDate(h.getDate()),this._dateAllowed(j,f,g)},_stopPropagation:function(f){f.stopPropagation()}});</script></dom-module></body></html>