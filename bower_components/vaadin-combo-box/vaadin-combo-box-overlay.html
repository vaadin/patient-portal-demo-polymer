<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../iron-list/iron-list.html"><link rel="import" href="../paper-styles/shadow.html"><link rel="import" href="vaadin-overlay-behavior.html"><link rel="import" href="vaadin-combo-box-item.html"><link rel="import" href="vaadin-spinner.html"></head><body><dom-module id="vaadin-combo-box-overlay"><template><style>:host{position:absolute;@apply --shadow-elevation-2dp;background:#fff;border-radius:0 0 2px 2px;top:0;left:0;pointer-events:auto;z-index:200;overflow:hidden;}#scroller{overflow:auto;max-height:var(--vaadin-combo-box-overlay-max-height, 65vh);transform:translate3d(0, 0, 0);-webkit-overflow-scrolling:touch;}#selector{--iron-list-items-container:{border-top:8px solid transparent;border-bottom:8px solid transparent;};}#selector vaadin-combo-box-item{cursor:pointer;padding:13px 16px;color:var(--primary-text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}:host([opened][loading]){display:block !important;height:58px;}#selector:not([touch-device]) vaadin-combo-box-item:hover,
      #selector vaadin-combo-box-item[focused]{background:#eee;}#selector vaadin-combo-box-item[selected]{color:var(--primary-color);}</style><vaadin-spinner active="[[loading]]"></vaadin-spinner><div id="scroller" scroller="[[_getScroller()]]" on-tap="_stopPropagation" on-touchstart="_onTouchStart" on-touchend="_preventDefault" on-scroll="_onScroll" hidden$="[[loading]]"><iron-list id="selector" touch-device$="[[touchDevice]]" role="listbox" items="[[_items]]" scroll-target="[[_getScroller()]]"><template><vaadin-combo-box-item on-tap="_onTap" index="[[index]]" item="[[item]]" label="[[getItemLabel(item)]]" selected="[[_isItemSelected(item, _selectedItem)]]" role$="[[_getAriaRole(index)]]" aria-selected$="[[_getAriaSelected(_focusedIndex,index)]]" focused="[[_isItemFocused(_focusedIndex,index)]]"></vaadin-combo-box-item></template></iron-list></div></template></dom-module><script>Polymer({is:'vaadin-combo-box-overlay',behaviors:[vaadin.elements.combobox.OverlayBehavior],properties:{touchDevice:{type:Boolean,reflectToAttribute:!0,value:function(){try{return document.createEvent('TouchEvent'),!0}catch(b){return!1}}},loading:{type:Boolean,value:!1,reflectToAttribute:!0,observer:'notifyResize'},_selectedItem:{type:Object},_items:{type:Object},_focusedIndex:{type:Number,notify:!0,value:-1,observer:'_focusedIndexChanged'},_focusedItem:{type:String,computed:'_getFocusedItem(_focusedIndex)'},_itemLabelPath:{type:String,value:'label'},_itemValuePath:{type:String,value:'value'},_notTapping:Boolean,_ignoreTaps:Boolean},ready:function(){this._patchWheelOverScrolling(),this.$.selector._scroller!==void 0&&(this.$.selector._scroller=this._getScroller())},_getFocusedItem:function(b){if(0<=b)return this._items[b]},_isItemSelected:function(b,c){return b===c},_onTap:function(b){this._notTapping||this._ignoreTaps||this.fire('selection-changed',{item:b.model.item})},_onTouchStart:function(){this._notTapping=!1,this.async(function(){this._notTapping=!0},300)},_onScroll:function(){this._ignoreTaps=!0,this.debounce('restore-taps',function(){this._ignoreTaps=!1},300)},indexOfLabel:function(b){if(this._items&&b)for(var c=0;c<this._items.length;c++)if(this.getItemLabel(this._items[c]).toString().toLowerCase()===b.toString().toLowerCase())return c;return-1},getItemLabel:function(b){var c=b?this.get(this._itemLabelPath,b):void 0;return void 0===c&&(c=b?b.toString():''),c},_isItemFocused:function(b,c){return b==c},_getAriaSelected:function(b,c){return this._isItemFocused(b,c).toString()},_getAriaRole:function(b){return b!==void 0&&'option'},_focusedIndexChanged:function(b){0<=b&&this._scrollIntoView(b)},_scrollIntoView:function(b){var c=this._visibleItemsCount();if(void 0!==c){var d=b;b>this.$.selector.lastVisibleIndex-1?d=b-c+1:b>this.$.selector.firstVisibleIndex&&(d=this.$.selector.firstVisibleIndex),this.$.selector.scrollToIndex(Math.max(0,d));var f=this._items[b];if(void 0!==f){var g=this.$.selector._getPhysicalIndex(f),h=this.$.selector._physicalItems[g];if(h){var j=h.getBoundingClientRect(),k=this.$.scroller.getBoundingClientRect(),l=j.bottom-k.bottom+this._viewportTotalPaddingBottom;0<l&&(this.$.scroller.scrollTop+=l)}}}},ensureItemsRendered:function(){this.$.selector.flushDebouncer('_debounceTemplate')},adjustScrollPosition:function(){this._items&&this._scrollIntoView(this._focusedIndex)},_getScroller:function(){return this.$.scroller},_patchWheelOverScrolling:function(){var b=this.$.selector;b.addEventListener('wheel',function(c){var d=b._scroller||b.scrollTarget,f=0===d.scrollTop,g=1>=d.scrollHeight-d.scrollTop-d.clientHeight;f&&0>c.deltaY?c.preventDefault():g&&0<c.deltaY&&c.preventDefault()})},updateViewportBoundaries:function(){this._cachedViewportTotalPaddingBottom=void 0,this.$.selector.updateViewportBoundaries()},get _viewportTotalPaddingBottom(){if(this._cachedViewportTotalPaddingBottom===void 0){var a=window.getComputedStyle(this._unwrapIfNeeded(this.$.selector.$.items));this._cachedViewportTotalPaddingBottom=[a.paddingBottom,a.borderBottomWidth].map(function(b){return parseInt(b,10)}).reduce(function(b,c){return b+c})}return this._cachedViewportTotalPaddingBottom},_visibleItemsCount:function(){return this.$.selector.flushDebouncer('_debounceTemplate'),this.$.selector.scrollToIndex(this.$.selector.firstVisibleIndex),this.updateViewportBoundaries(),this.$.selector.lastVisibleIndex-this.$.selector.firstVisibleIndex+1},_selectItem:function(b){b='number'==typeof b?this._items[b]:b,this.$.selector.selectedItem!==b&&this.$.selector.selectItem(b)},_preventDefault:function(b){b.cancelable&&b.preventDefault()},_stopPropagation:function(b){b.stopPropagation()}});</script></body></html>