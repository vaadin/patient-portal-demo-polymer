<html><head><link rel="import" href="../iron-form-element-behavior/iron-form-element-behavior.html"><link rel="import" href="../iron-a11y-announcer/iron-a11y-announcer.html"><link rel="import" href="vaadin-dropdown-behavior.html"><script>window.vaadin=window.vaadin||{},vaadin.elements=vaadin.elements||{},vaadin.elements.combobox=vaadin.elements.combobox||{},vaadin.elements.combobox.ComboBoxBehaviorImpl={properties:{items:{type:Array},allowCustomValue:{type:Boolean,value:!1},filteredItems:{type:Array},value:{type:String,observer:'_valueChanged',notify:!1},_lastCommittedValue:String,hasValue:{type:Boolean,value:!1,readOnly:!0,reflectToAttribute:!0},loading:{type:Boolean,value:!1},_focusedIndex:{type:Number,value:-1},filter:{type:String,value:'',notify:!0},selectedItem:{type:Object,notify:!0,value:function(){return null}},itemLabelPath:{type:String,value:'label'},itemValuePath:{type:String,value:'value'},inputElement:{type:HTMLElement,readOnly:!0},_toggleElement:Object,_clearElement:Object,_inputElementValue:String,_closeOnBlurIsPrevented:Boolean,_templatized:Boolean,_itemTemplate:Boolean,_previousDocumentPointerEvents:String},observers:['_filterChanged(filter, itemValuePath, itemLabelPath)','_itemsChanged(items.*, itemValuePath, itemLabelPath)','_filteredItemsChanged(filteredItems.*, itemValuePath, itemLabelPath)','_loadingChanged(loading)','_selectedItemChanged(selectedItem)'],listeners:{'vaadin-dropdown-opened':'_onOpened','vaadin-dropdown-closed':'_onClosed',keydown:'_onKeyDown',tap:'_onTap','overlay.selection-changed':'_overlaySelectedItemChanged'},ready:function(){this.value===void 0&&(this.value=''),this._lastCommittedValue=this.value,Polymer.IronA11yAnnouncer.requestAvailability()},_onBlur:function(){this._closeOnBlurIsPrevented||this.close()},_onOverlayDown:function(b){this.$.overlay.touchDevice&&b.target!==this.$.overlay.$.scroller&&(this._closeOnBlurIsPrevented=!0,this.inputElement.blur(),this._closeOnBlurIsPrevented=!1)},_onTap:function(b){this._closeOnBlurIsPrevented=!0;var c=Polymer.dom(b).path;-1===c.indexOf(this._clearElement)?-1===c.indexOf(this._toggleElement)?-1!==c.indexOf(this.inputElement)&&this._openAsync():this._toggle():this._clear(),this._closeOnBlurIsPrevented=!1},_onKeyDown:function(b){this._isEventKey(b,'down')?(this._closeOnBlurIsPrevented=!0,this._onArrowDown(),this._closeOnBlurIsPrevented=!1,b.preventDefault()):this._isEventKey(b,'up')?(this._closeOnBlurIsPrevented=!0,this._onArrowUp(),this._closeOnBlurIsPrevented=!1,b.preventDefault()):this._isEventKey(b,'enter')?this._onEnter(b):this._isEventKey(b,'esc')&&this._onEscape()},_isEventKey:function(b,c){return Polymer.IronA11yKeysBehavior.keyboardEventMatchesKeys(b,c)},_getItemLabel:function(b){return this.$.overlay.getItemLabel(b)},_getItemValue:function(b){var c=b?this.get(this.itemValuePath,b):void 0;return void 0===c&&(c=b?b.toString():''),c},_onArrowDown:function(){this.opened?this.$.overlay._items&&(this._focusedIndex=Math.min(this.$.overlay._items.length-1,this._focusedIndex+1),this._prefillFocusedItemLabel()):this.open()},_onArrowUp:function(){this.opened?(-1<this._focusedIndex?this._focusedIndex=Math.max(0,this._focusedIndex-1):this.$.overlay._items&&(this._focusedIndex=this.$.overlay._items.length-1),this._prefillFocusedItemLabel()):this.open()},_prefillFocusedItemLabel:function(){-1<this._focusedIndex&&(this._inputElementValue='',this.async(function(){this._inputElementValue=this._getItemLabel(this.$.overlay._focusedItem),this._setSelectionRange()},1))},_setSelectionRange:function(){this.inputElement.setSelectionRange&&this.inputElement.setSelectionRange(0,this._inputElementValue.length)},_onEnter:function(b){this.opened&&(this.allowCustomValue||''===this._inputElementValue||-1<this._focusedIndex)&&(this.close(),b.preventDefault())},_onEscape:function(){this.opened&&(-1<this._focusedIndex?(this._focusedIndex=-1,this._revertInputValue()):this.cancel())},_openAsync:function(){this.async(this.open)},_toggle:function(){this.opened?this.close():this.open()},_clear:function(){this.selectedItem=null,this.allowCustomValue&&(this.value=''),this.opened?this.close():this._detectAndDispatchChange()},cancel:function(){this._revertInputValueToValue(),this._lastCommittedValue=this.value,this.close()},_onOpened:function(){this.$.overlay.hidden=!this._hasItems(this.$.overlay._items)&&!this.loading,this.$.overlay.ensureItemsRendered(),this.$.overlay.updateViewportBoundaries(),this.$.overlay.async(this.$.overlay.adjustScrollPosition),this.$.overlay.async(this.$.overlay.notifyResize,1),this._previousDocumentPointerEvents=document.body.style.pointerEvents,document.body.style.pointerEvents='none',this._lastCommittedValue=this.value},_onClosed:function(){if(-1<this._focusedIndex){var b=this.$.overlay._items[this._focusedIndex];this.selectedItem!==b&&(this.selectedItem=b),this._inputElementValue=this._getItemLabel(this.selectedItem)}else if(''===this._inputElementValue)this._clear();else if(this.allowCustomValue){var c=this.fire('custom-value-set',this._inputElementValue,{cancelable:!0});if(!c.defaultPrevented){var d=this._inputElementValue;this.selectedItem=null,this.value=d}}else this._inputElementValue=this._getItemLabel(this.selectedItem);this._detectAndDispatchChange(),this._clearSelectionRange(),this.filter='',document.body.style.pointerEvents=this._previousDocumentPointerEvents},_inputValueChanged:function(b){-1!==Polymer.dom(b).path.indexOf(this.inputElement)&&(this.filter===this._inputElementValue?this._filterChanged(this.filter):(this._userDefinedFilter=!0,this.filter=this._inputElementValue,this._userDefinedFilter=!1),!this.opened&&this.open())},_clearSelectionRange:function(){if(document.activeElement===this.inputElement&&this.inputElement.setSelectionRange){var b=this._inputElementValue?this._inputElementValue.length:0;this.inputElement.setSelectionRange(b,b)}},_filterChanged:function(b){this.items&&(this.filteredItems=this._filterItems(this.items,b))},_loadingChanged:function(b){b&&(this._focusedIndex=-1)},_revertInputValue:function(){''===this.filter?this._revertInputValueToValue():this._inputElementValue=this.filter,this._clearSelectionRange()},_revertInputValueToValue:function(){this._inputElementValue=this.allowCustomValue&&!this.selectedItem?this.value:this._getItemLabel(this.selectedItem)},_selectedItemChanged:function(b){if(this.filteredItems){if(null===b)this.allowCustomValue||(this.value=''),this._setHasValue(''!==this.value),this._inputElementValue=this.value;else{var c=this._getItemValue(b);this.value!==c&&(this.value=c),this._setHasValue(!0),this._inputElementValue=this._getItemLabel(b)}this.$.overlay._selectedItem=b,this._focusedIndex=this.filteredItems.indexOf(b)}},_valueChanged:function(b){if(this._isValidValue(b)){if(this._getItemValue(this.selectedItem)!==b){var c=this._indexOfValue(b,this.filteredItems);this.selectedItem=0<=c?this.filteredItems[c]:null}else var d=this.selectedItem;!d&&this.allowCustomValue&&(this._inputElementValue=b),this._setHasValue(''!==this.value)}else this.selectedItem=null;this._lastCommittedValue=void 0},_detectAndDispatchChange:function(){this.value!==this._lastCommittedValue&&(this.fire('change',void 0,{bubbles:!0}),this._lastCommittedValue=this.value)},_itemsChanged:function(b){if('items'===b.path||'items.splices'===b.path){this.filteredItems=this.items?this.items.slice(0):this.items;var c=this._indexOfValue(this.value,this.items);this._focusedIndex=c;var d=-1<c&&this.items[c];d&&(this.selectedItem=d)}},_filteredItemsChanged:function(b){('filteredItems'===b.path||'filteredItems.splices'===b.path)&&(this._setOverlayItems(this.filteredItems),this._focusedIndex=this.opened||this._userDefinedFilter?this.$.overlay.indexOfLabel(this.filter):this._indexOfValue(this.value,this.filteredItems),this.async(function(){this.$.overlay.notifyResize()},1))},_filterItems:function(b,c){return b?b.filter(function(d){return c=c?c.toString().toLowerCase():'',-1<this._getItemLabel(d).toString().toLowerCase().indexOf(c)}.bind(this)):b},_setOverlayItems:function(b){this.$.overlay.notifyPath('_items',void 0),this.$.overlay.set('_items',b),this.$.overlay.hidden=!this._hasItems(b),this.$.overlay.notifyResize()},_hasItems:function(b){return b&&b.length},_indexOfValue:function(b,c){if(c&&this._isValidValue(b))for(var d=0;d<c.length;d++)if(this._getItemValue(c[d])===b)return d;return-1},_isValidValue:function(b){return b!==void 0&&null!==b},_overlaySelectedItemChanged:function(b,c){this.selectedItem!==c.item&&(this.selectedItem=c.item),this.opened&&this.close(),b.stopPropagation()},_getValidity:function(){if(this.inputElement.validate)return this.inputElement.validate()},get _instanceProps(){return{item:!0,index:!0,selected:!0,focused:!0}},_ensureTemplatized:function(){this._templatized||(this._templatized=!0,this._itemTemplate=Polymer.dom(this).querySelector('template'),this._itemTemplate&&this.templatize(this._itemTemplate))},_forwardParentProp:function(b,c){var d=this.$.overlay.$.selector.querySelectorAll('vaadin-combo-box-item');Array.prototype.forEach.call(d,function(f){f._itemTemplateInstance[b]=c})},_forwardParentPath:function(b,c){var d=this.$.overlay.$.selector.querySelectorAll('vaadin-combo-box-item');Array.prototype.forEach.call(d,function(f){f._itemTemplateInstance.notifyPath(b,c,!0)})},_preventInputBlur:function(){this._toggleElement&&this.listen(this._toggleElement,'down','_preventDefault'),this._clearElement&&this.listen(this._clearElement,'down','_preventDefault')},_restoreInputBlur:function(){this._toggleElement&&this.unlisten(this._toggleElement,'down','_preventDefault'),this._clearElement&&this.unlisten(this._clearElement,'down','_preventDefault')},_preventDefault:function(b){b.preventDefault()},_stopPropagation:function(b){b.stopPropagation()}},vaadin.elements.combobox.ComboBoxBehavior=[Polymer.IronFormElementBehavior,Polymer.Templatizer,vaadin.elements.combobox.DropdownBehavior,vaadin.elements.combobox.ComboBoxBehaviorImpl];</script></head><body></body></html>